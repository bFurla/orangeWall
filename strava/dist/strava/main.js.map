{"version":3,"file":"main.js","mappings":"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","sources":["./src/app/app-routing.module.ts","./src/app/app.component.ts","./src/app/app.component.html","./src/app/app.module.ts","./src/app/pages/home/home.component.ts","./src/app/pages/home/home.component.html","./src/app/pages/user/user.component.ts","./src/app/pages/user/user.component.html","./src/app/user.service.ts","./src/app/utils/auth-interceptor.service.ts","./src/app/utils/connexion.guard.ts","./src/environments/environment.dev.ts","./src/main.ts"],"sourcesContent":["import {NgModule} from '@angular/core';\nimport {RouterModule, Routes} from \"@angular/router\";\nimport {HomeComponent} from \"./pages/home/home.component\";\nimport {UserComponent} from \"./pages/user/user.component\";\nimport {connexionGuard} from \"./utils/connexion.guard\";\n\nexport const routes: Routes = [\n  {\n    pathMatch: 'full',\n    path: '',\n    redirectTo: 'home',\n  },\n  {\n    path: 'home',\n    component: HomeComponent\n  },\n  {\n    path: 'user',\n    component: UserComponent,\n    canActivate: [connexionGuard]\n  },\n  {\n    path: '**',\n    redirectTo: 'home'\n  }\n];\n\n@NgModule({\n  exports: [RouterModule],\n  imports: [\n    RouterModule.forRoot(routes)\n  ]\n})\nexport class AppRoutingModule {\n}\n","import { Component } from '@angular/core';\nimport { environment } from './../environments/environment';\nimport { JwksValidationHandler } from 'angular-oauth2-oidc-jwks';\nimport {AuthConfig, OAuthService} from \"angular-oauth2-oidc\";\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})\nexport class AppComponent {\n  env = environment.env;\n\n  constructor(private readonly oAuthService: OAuthService) {\n    this.configure();\n  }\n\n  authConfig : AuthConfig = {\n    issuer: environment.issuer,\n    redirectUri: environment.redirectUri,\n    logoutUrl : environment.logoutUrl,\n    clientId: environment.clientId,\n    scope: environment.scope,\n    clearHashAfterLogin: environment.clearHashAfterLogin,\n    strictDiscoveryDocumentValidation: environment.strictDiscoveryDocumentValidation\n  }\n\n  private configure() {\n    this.oAuthService.configure(this.authConfig);\n    this.oAuthService.tokenValidationHandler = new JwksValidationHandler();\n    if(!this.oAuthService.getIdToken()){\n      this.oAuthService.loadDiscoveryDocumentAndTryLogin().then(r => console.log(r));\n    }\n  }\n\n  get isLoggedIn() {\n    return !!this.oAuthService.getIdToken();\n  }\n\n  handleLoginClick() {\n    if(!this.isLoggedIn) {\n      this.oAuthService.initLoginFlow();\n    }\n    else {\n      this.oAuthService.logOut();\n\n    }\n  }\n\n}\n","<header>\n  MyStrava\n  <button (click)=\"handleLoginClick()\">{{isLoggedIn ? 'Logout' : 'Login'}}</button>\n</header>\n<router-outlet></router-outlet>\n<footer>\n  {{env}}\n</footer>\n","import {NgModule} from '@angular/core';\nimport {BrowserModule} from '@angular/platform-browser';\n\nimport {AppComponent} from './app.component';\nimport {OAuthModule} from \"angular-oauth2-oidc\";\nimport {HTTP_INTERCEPTORS, HttpClientModule} from \"@angular/common/http\";\nimport {HomeComponent} from './pages/home/home.component';\nimport {UserComponent} from './pages/user/user.component';\nimport {AppRoutingModule} from \"./app-routing.module\";\nimport {AuthInterceptorService} from \"./utils/auth-interceptor.service\";\nimport { LocationStrategy, HashLocationStrategy} from '@angular/common';\n\n@NgModule({\n  declarations: [\n    AppComponent,\n    HomeComponent,\n    UserComponent\n  ],\n  imports: [\n    BrowserModule,\n    HttpClientModule,\n    OAuthModule.forRoot(),\n    AppRoutingModule\n  ],\n  providers: [\n    {\n      provide: HTTP_INTERCEPTORS,\n      useClass: AuthInterceptorService,\n      multi: true,\n    },\n    {provide: LocationStrategy, useClass: HashLocationStrategy}\n  ],\n  bootstrap: [AppComponent]\n})\nexport class AppModule {\n}\n","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: './home.component.html',\n  styleUrls: ['./home.component.css']\n})\nexport class HomeComponent {\n\n}\n","<p>home works!</p>\n","import { Component } from '@angular/core';\nimport {UserService} from \"../../user.service\";\nimport {OAuthService} from \"angular-oauth2-oidc\";\n\n@Component({\n  selector: 'app-user',\n  templateUrl: './user.component.html',\n  styleUrls: ['./user.component.css']\n})\nexport class UserComponent {\n\n  constructor(private readonly userService: UserService , private readonly authService: OAuthService) { }\n\n  ngOnInit(): void {\n    console.log(this.authService.getIdentityClaims());\n    console.log(this.authService.getIdToken());\n    console.log(this.authService.getAccessToken());\n  }\n\n  getClaims() : Record<string, any> {\n    return this.authService.getIdentityClaims();\n  }\n\n  getUser(): void {\n    this.userService.getUser2().subscribe((user) => {\n      console.log(user);\n    });\n  }\n\n}\n","<p>user works!</p>\n<button (click)=\"getUser()\">GET USER</button>\n<div>\n{{getClaims() | json}}\n</div>\n","import { Injectable } from '@angular/core';\r\nimport {Observable} from \"rxjs\";\r\nimport {HttpClient, HttpHeaders} from \"@angular/common/http\";\r\nimport { environment } from 'src/environments/environment';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UserService {\r\n\r\n  private readonly mainUrl: string;\r\n\r\n  constructor(private readonly httpClient: HttpClient) {\r\n    this.mainUrl = environment.baseHref;\r\n  }\r\n\r\n\r\n  getUser2(): Observable<any> {\r\n      return this.httpClient.get<any>(`${this.mainUrl}/api/user/me2`);\r\n  }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport {HttpHandler, HttpHeaders, HttpInterceptor, HttpRequest} from '@angular/common/http';\r\nimport {OAuthService} from \"angular-oauth2-oidc\";\r\n\r\n@Injectable()\r\nexport class AuthInterceptorService implements HttpInterceptor {\r\n\r\n  constructor(private readonly oauthService: OAuthService) {\r\n  }\r\n\r\n  intercept(req: HttpRequest<any>, next: HttpHandler) {\r\n    // Get the authorization token from your preferred source (e.g., local storage, session storage, etc.)\r\n    const authToken: string = this.oauthService.getIdToken();\r\n\r\n    // Si pas de token, on laisse passer la requête sans modification\r\n    if(!authToken) {\r\n      return next.handle(req);\r\n    }\r\n\r\n    // Clone the request and set the Authorization header\r\n    const authReq = req.clone({\r\n      headers: new HttpHeaders({\r\n        'Authorization': `Bearer ${authToken}`,\r\n        'Access-Control-Allow-Origin': '*'\r\n      })\r\n    });\r\n\r\n    // Pass the modified request to the next interceptor or the HttpHandler\r\n    return next.handle(authReq);\r\n  }\r\n}\r\n","import { CanActivateFn } from '@angular/router';\nimport {inject} from \"@angular/core\";\nimport {OAuthService} from \"angular-oauth2-oidc\";\n\nexport const connexionGuard: CanActivateFn = (route, state) => {\n  const ouathService = inject(OAuthService);\n  if(!ouathService.hasValidAccessToken() || !ouathService.hasValidIdToken()) {\n    ouathService.initLoginFlow();\n  }\n  return ouathService.hasValidAccessToken() && ouathService.hasValidIdToken();\n};\n","export const environment = {\r\n  production: false,\r\n  env: 'dev',\r\n  issuer: 'https://accounts.google.com',\r\n  redirectUri: 'https://orangewall.web.app/',\r\n  logoutUrl: 'https://orangewall.web.app/home',\r\n  clientId: '620220236078-n3nnnfaoeop7221gh8e2cofte26578io.apps.googleusercontent.com',\r\n  scope: 'openid profile email',\r\n  clearHashAfterLogin: false,\r\n  strictDiscoveryDocumentValidation: false,\r\n  baseHref: 'https://orangewall.ey.r.appspot.com'\r\n}\r\n","import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\n\n\nplatformBrowserDynamic().bootstrapModule(AppModule)\n  .catch(err => console.error(err));\n"],"names":["RouterModule","HomeComponent","UserComponent","connexionGuard","routes","pathMatch","path","redirectTo","component","canActivate","AppRoutingModule","forRoot","imports","i1","exports","environment","JwksValidationHandler","AppComponent","constructor","oAuthService","env","authConfig","issuer","redirectUri","logoutUrl","clientId","scope","clearHashAfterLogin","strictDiscoveryDocumentValidation","configure","tokenValidationHandler","getIdToken","loadDiscoveryDocumentAndTryLogin","then","r","console","log","isLoggedIn","handleLoginClick","initLoginFlow","logOut","i0","ɵɵdirectiveInject","OAuthService","selectors","decls","vars","consts","template","AppComponent_Template","rf","ctx","ɵɵelementStart","ɵɵtext","ɵɵlistener","AppComponent_Template_button_click_2_listener","ɵɵelementEnd","ɵɵelement","ɵɵadvance","ɵɵtextInterpolate","ɵɵtextInterpolate1","BrowserModule","OAuthModule","HTTP_INTERCEPTORS","HttpClientModule","AuthInterceptorService","LocationStrategy","HashLocationStrategy","AppModule","bootstrap","provide","useClass","multi","declarations","HomeComponent_Template","userService","authService","ngOnInit","getIdentityClaims","getAccessToken","getClaims","getUser","getUser2","subscribe","user","UserService","i2","UserComponent_Template","UserComponent_Template_button_click_2_listener","ɵɵpipeBind1","httpClient","mainUrl","baseHref","get","ɵɵinject","HttpClient","factory","ɵfac","providedIn","HttpHeaders","oauthService","intercept","req","next","authToken","handle","authReq","clone","headers","inject","route","state","ouathService","hasValidAccessToken","hasValidIdToken","production","__NgCli_bootstrap_1","platformBrowser","bootstrapModule","catch","err","error"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}